# AI Execution Envelope

> **自主 Agent 执行现实副作用的治理框架。**

[![状态](https://img.shields.io/badge/状态-提案%20v0.1-orange)]()
[![许可](https://img.shields.io/badge/许可-CC%20BY--SA%204.0-blue.svg)]()

**Language / 语言：** [English](README.md) | 中文

---

## 问题

当 LLM 只是编程助手时，传统软件工程足够。

当 LLM 成为自主执行主体——修改数据库、下达交易指令、触发部署、调用外部 API，且无需人工逐次审核时——治理模型开始失效。

**代码中心（Code-Centric）治理的默认假设是：每一个动作都有人类负责。**
这个假设已不再成立。

失效模式是结构性的，而非偶然的：

- 风险控制嵌入策略代码，缺乏独立的强制层
- 执行前没有可强制的授权边界
- 违规只能事后发现，而此时副作用已成既成事实

---

## 提案

**执行包线中心（Execution Envelope–Centric）治理。**

> **执行包线（Execution Envelope）** 是一个形式化且可强制执行的边界，定义了自主 Agent 被允许执行的所有动作范围。Agent 必须在此边界内运行。

每一个自主任务，都必须在任何代码运行之前，由一个执行包线进行约束。

执行包线定义：

| 字段 | 用途 |
|---|---|
| `goal` | 声明的任务意图 |
| `capabilities` | Agent 可访问的资源范围 |
| `budgets` | 资源消耗的硬性上限 |
| `forbidden` | 明确禁止的动作 |
| `postconditions` | 可验证的完成条件 |

执行包线不是文档，而是**控制平面（control plane）**——在执行前完成验证，在运行时由独立于 Agent 控制域之外的代理强制执行。

---

## 核心原则

**1. 执行包线先于代码存在。**
在没有有效且经过验证的执行包线的情况下，任何 Agent 动作都不被允许。代码是实现细节；执行包线才是权威。

**2. 强制执行不是可选项。**
如果 Agent 可以通过任何路径绕过强制层，架构即告失效。强制执行必须是物理层和网络层的既成事实，而不是约定。

**3. 控制平面必须独立。**
执行包线的定义与强制逻辑，必须运行在 Agent 控制域之外。能够修改自身治理层的 Agent，等于没有治理层。

**4. 执行包线是临时能力实例。**
执行包线不是长期权限授予，而是针对单次任务执行的、有范围限定、有时效限制的授权。

**5. 合规 ≠ 正确。**
执行包线保证行为合法性，而非语义正确性。质量保证需要独立的机制。

---

## 这不是什么

| 不是 | 原因 |
|---|---|
| IAM 的替代品 | IAM 管理长期身份权限（静态）；执行包线管理单次任务授权（动态）。 |
| OPA/Cedar 的替代品 | 策略引擎负责评估规则；执行包线为其提供结构化的任务实例供评估。 |
| Temporal 的替代品 | Temporal 保证执行一致性；执行包线决定是否允许执行。 |
| 新编程语言 | 通用语言仍用于数据平面；执行包线是控制平面。 |
| 正确性保证 | 执行包线约束行为边界，不保证边界内的行为能产生正确结果。 |

---

## 仓库结构

```
ai-execution-envelope/
│
├── README.md                        # 英文版
├── README.zh.md                     # 本文件（中文版）
│
├── spec/
│   └── PRINCIPLES.md                # 框架原则的正式声明
│
├── schema/
│   └── envelope.schema.json         # 执行包线 JSON Schema v0.1
│
├── examples/
│   └── trading/
│       ├── envelope.json            # 示例：MNQ 日内策略包线
│       └── template.json            # 示例：组织级包线模板
│
├── gateway/
│   └── VERIFICATION_SPEC.md         # Gateway 强制执行规范
│
└── docs/
    └── THREAT_MODEL.md              # 威胁模型与非目标声明
```

---

## 威胁模型（摘要）

本框架处理：

- Agent 动作超出授权边界
- 资源消耗无上限
- 未经预验证触发不可逆副作用
- 无法审计或重放的动作

本框架**不**处理：

- LLM 幻觉或语义错误
- 算法正确性
- 数据准确性
- 市场或财务风险
- 战略决策质量

完整威胁模型：[`docs/THREAT_MODEL.md`](docs/THREAT_MODEL.md)

---

## 三层生成模型

执行包线不由 LLM 自由生成——否则治理将是空洞的。

```
第一层：组织定义包线模板
        （人工 + 安全团队，版本化管理，需评审）
              ↓
第二层：LLM 在模板边界内实例化参数
        （填写任务特定字段；不能创建新的能力类型）
              ↓
第三层：Verifier 在执行前检查包线
        （自动化验证 + 必要时触发人工审批）
              ↓
        执行被允许（或被拒绝）
```

LLM 是**参数实例化者**，而不是规则制定者。

---

## 强制执行架构

```
┌─────────────────────┐
│   Agent / 策略代码   │  ← 无 API 密钥，无外部网络访问。
│   （数据平面）       │    只能向 Gateway 提交请求。
└──────────┬──────────┘
           │ 仅限内部请求
           ▼
┌─────────────────────┐
│   Order Gateway /   │  ← 持有凭证，强制执行包线。
│   运行时代理         │    运行在 Agent 控制域之外。
│   （控制平面）       │    记录每一个动作。
└──────────┬──────────┘
           │ 仅限已验证、已授权的调用
           ▼
┌─────────────────────┐
│   外部系统           │
│   （交易所 / API）   │
└─────────────────────┘
```

**如果 Agent 能通过 Gateway 以外的任何路径到达外部系统，架构即告失效。**

完整强制执行规范：[`gateway/VERIFICATION_SPEC.md`](gateway/VERIFICATION_SPEC.md)

---

## 当前状态

这是一个**框架提案**，而非生产实现。

- [x] 威胁模型
- [x] 核心原则
- [x] JSON Schema v0.1
- [x] 交易场景示例
- [x] Gateway 验证规范
- [ ] 参考实现（Gateway 代理）
- [ ] 能力格（Capability Lattice）的形式化定义
- [ ] 跨组织包线交换协议

---

## 参与贡献

本项目处于早期提案阶段，最需要的贡献方向：

- 对威胁模型的批评与补充
- 替代性的强制执行架构方案
- 其他领域的包线示例（部署、数据库迁移、支付等）
- 能力语义的形式化处理

---

## 许可

CC BY-SA 4.0
